document.getElementById('btn').onclick = async () => {
    const status = document.getElementById('status');
    const resultDiv = document.getElementById('result');
    const imgUrl = document.getElementById('imgUrl').value;

    if (!imgUrl) return alert("–í—Å—Ç–∞–≤ –ø–æ—Å–∏–ª–∞–Ω–Ω—è!");

    status.innerText = "üé¨ –ó–∞–ø–∏—Ç –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ...";
    
    try {
        const startRes = await fetch('/start', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ image_url: imgUrl, prompt: document.getElementById('prompt').value })
        });
        
        const { request_id } = await startRes.json();
        
        // –û–ø–∏—Ç—É—î–º–æ –¢–≤—ñ–π —Å–µ—Ä–≤–µ—Ä –∫–æ–∂–Ω—ñ 3 —Å–µ–∫—É–Ω–¥–∏ (—Ü–µ –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–æ —ñ —à–≤–∏–¥–∫–æ)
        const poll = setInterval(async () => {
            status.innerText = "‚è≥ –û—á—ñ–∫—É—î–º–æ —Å–∏–≥–Ω–∞–ª –≤—ñ–¥ –Ω–µ–π—Ä–æ–º–µ—Ä–µ–∂—ñ...";
            const res = await fetch(`/check/${request_id}`);
            
            if (res.status === 200) {
                const data = await res.json();
                clearInterval(poll);
                status.innerText = "‚úÖ –í—ñ–¥–µ–æ –≥–æ—Ç–æ–≤–µ!";
                resultDiv.innerHTML = `<video controls src="${data.video.url}"></video>`;
            }
        }, 3000);

    } catch (e) {
        status.innerText = "–ü–æ–º–∏–ª–∫–∞ –∑–≤'—è–∑–∫—É –∑ —Å–µ—Ä–≤–µ—Ä–æ–º.";
    }
};