document.getElementById('btn').onclick = async () => {
    const status = document.getElementById('status');
    const resultDiv = document.getElementById('result');
    
    status.innerText = "üé¨ –ó–∞–ø–∏—Ç –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ –≤ —á–µ—Ä–≥—É...";
    
    try {
        // –ö—Ä–æ–∫ 1: –û—Ç—Ä–∏–º—É—î–º–æ ID –∑–∞–ø–∏—Ç—É
        const startRes = await fetch('/start', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                image_url: document.getElementById('imgUrl').value,
                prompt: document.getElementById('prompt').value
            })
        });
        const { request_id } = await startRes.json();
        
        // –ö—Ä–æ–∫ 2: –û–ø–∏—Ç—É—î–º–æ —Å—Ç–∞—Ç—É—Å
        const checkStatus = setInterval(async () => {
            status.innerText = `‚è≥ –û–±—Ä–æ–±–∫–∞ –≤ —á–µ—Ä–∑—ñ (ID: ${request_id})...`;
            
            const res = await fetch(`/status/${request_id}`);
            if (res.status === 200) {
                const data = await res.json();
                clearInterval(checkStatus);
                status.innerText = "‚úÖ –ì–æ—Ç–æ–≤–æ!";
                resultDiv.innerHTML = `<video controls src="${data.video.url}"></video>`;
            }
        }, 5000); // –ö–æ–∂–Ω—ñ 5 —Å–µ–∫—É–Ω–¥

    } catch (e) {
        status.innerText = "–ü–æ–º–∏–ª–∫–∞: " + e.message;
    }
};