<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI Video Generator Pro</title>
    <style>
        body { font-family: 'Inter', -apple-system, sans-serif; background-color: #f0f2f5; display: flex; flex-direction: column; align-items: center; min-height: 100vh; margin: 0; padding: 2rem 1rem; box-sizing: border-box; }
        .container { background: white; padding: 2.5rem; border-radius: 20px; box-shadow: 0 12px 32px rgba(0,0,0,0.08); width: 100%; max-width: 500px; margin-bottom: 2rem; }
        h1 { font-size: 26px; color: #1a1a1a; margin-top: 0; margin-bottom: 1.5rem; text-align: center; font-weight: 700; }
        
        label { display: block; margin-bottom: 0.5rem; font-weight: 600; color: #4a4a4a; font-size: 14px; }
        input[type="text"], input[type="number"], select { width: 100%; padding: 14px; margin-bottom: 0.5rem; border: 1.5px solid #e1e4e8; border-radius: 10px; box-sizing: border-box; font-size: 15px; outline: none; transition: border 0.2s; background: white; }
        input:focus, select:focus { border-color: #0052cc; box-shadow: 0 0 0 3px rgba(0,82,204,0.1); }
        
        /* –û–ø–∏—Å –º–æ–¥–µ–ª—ñ */
        .model-info { background: #f8faff; border: 1px solid #cce0ff; padding: 12px; border-radius: 8px; font-size: 13px; color: #0042a3; margin-bottom: 1.5rem; line-height: 1.4; display: flex; flex-direction: column; gap: 4px; }
        .model-price { font-weight: 700; color: #008a00; }

        .drop-zone { width: 100%; border: 2px dashed #0052cc; border-radius: 12px; padding: 2rem; text-align: center; cursor: pointer; background: #f8faff; color: #0052cc; font-weight: 500; margin-bottom: 1rem; position: relative; }
        .drop-zone img { max-width: 100%; max-height: 250px; border-radius: 8px; display: none; margin: 0 auto; }
        .drop-text { pointer-events: none; }
        .divider { text-align: center; margin: 5px 0 15px; color: #999; font-size: 12px; text-transform: uppercase; letter-spacing: 1px; }

        button.primary-btn { width: 100%; padding: 16px; background: linear-gradient(135deg, #0052cc 0%, #0042a3 100%); color: white; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; transition: transform 0.1s; margin-top: 10px; }
        button.primary-btn:active { transform: scale(0.98); }
        button.primary-btn:disabled { background: #ccc; cursor: not-allowed; }

        .progress-container { width: 100%; height: 8px; background-color: #e1e4e8; border-radius: 4px; margin-top: 20px; overflow: hidden; display: none; }
        .progress-bar { height: 100%; width: 0%; background-color: #0052cc; transition: width 0.4s ease; }
        #status { margin-top: 1rem; font-size: 14px; color: #666; text-align: center; font-weight: 500; }
        
        .action-buttons { display: flex; gap: 10px; margin-top: 15px; }
        .action-btn { flex: 1; padding: 12px; border: 1.5px solid #e1e4e8; background: white; border-radius: 10px; font-weight: 600; color: #333; cursor: pointer; text-align: center; text-decoration: none; }
        #result { margin-top: 1.5rem; text-align: center; }
        video { width: 100%; border-radius: 14px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); background: #000; }
    </style>
</head>
<body>

<div class="container">
    <h1>–ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –≤—ñ–¥–µ–æ Pro</h1>

    <label for="modelSelect">ü§ñ –ù–µ–π—Ä–æ–º–µ—Ä–µ–∂–∞</label>
    <select id="modelSelect">
        <optgroup label="üì∑ –§–æ—Ç–æ —É –í—ñ–¥–µ–æ (Image-to-Video)">
            <option value="kling">Kling Video (2.0 Master / 3.0 Pro)</option>
            <option value="luma">Luma Dream Machine (v1.5)</option>
            <option value="minimax-img">MiniMax (Hailuo AI Video-01)</option>
        </optgroup>
        <optgroup label="üìù –¢–µ–∫—Å—Ç —É –í—ñ–¥–µ–æ (Text-to-Video)">
            <option value="minimax-text">MiniMax Hailuo-02</option>
            <option value="wan">Wan 2.5 (Open Source)</option>
            <option value="hunyuan">Hunyuan Video</option>
        </optgroup>
    </select>

    <div class="model-info" id="modelInfo">
        <span id="modelDesc">–ì—ñ–ø–µ—Ä—Ä–µ–∞–ª—ñ–∑–º, —ñ–¥–µ–∞–ª—å–Ω–∞ —Ñ—ñ–∑–∏–∫–∞ –∞–≤—Ç–æ —Ç–∞ –º—ñ—Å—Ç–∞. –ù–∞–π–∫—Ä–∞—â–∏–π –≤–∏–±—ñ—Ä –¥–ª—è —Ñ–æ—Ç–æ.</span>
        <span class="model-price">–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∞ —Ü—ñ–Ω–∞: ~$0.40 / 5 —Å–µ–∫</span>
    </div>

    <div id="imageSection">
        <label>–ó–æ–±—Ä–∞–∂–µ–Ω–Ω—è (–ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å –∞–±–æ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å)</label>
        <div class="drop-zone" id="dropZone">
            <span class="drop-text" id="dropText">üìÇ –ü–µ—Ä–µ—Ç—è–≥–Ω—ñ—Ç—å —Ñ–æ—Ç–æ —Å—é–¥–∏</span>
            <img id="imagePreview" src="" alt="Preview">
            <input type="file" id="fileInput" accept="image/jpeg, image/png, image/webp" style="display: none;">
        </div>
        <div class="divider">‚Äî –∞–±–æ ‚Äî</div>
        <input type="text" id="imgUrl" placeholder="–ü—Ä—è–º–µ –ø–æ—Å–∏–ª–∞–Ω–Ω—è (https://...)">
    </div>

    <label for="prompt" style="margin-top: 1rem;">–©–æ –º–∞—î –≤—ñ–¥–±—É–≤–∞—Ç–∏—Å—è? (–ü—Ä–æ–º–ø—Ç)</label>
    <input type="text" id="prompt" placeholder="–ù–∞–ø—Ä–∏–∫–ª–∞–¥: drone flyover, cinematic lighting">

    <button id="btn" class="primary-btn">‚ú® –ó–≥–µ–Ω–µ—Ä—É–≤–∞—Ç–∏ –≤—ñ–¥–µ–æ</button>

    <div id="progressContainer" class="progress-container"><div id="progressBar" class="progress-bar"></div></div>
    <p id="status"></p>
    <div id="result"></div>
</div>

<script>
    // –ë–ê–ó–ê –î–ê–ù–ò–• –û–ü–ò–°–Ü–í –ú–û–î–ï–õ–ï–ô
    const modelDetails = {
        "kling": { desc: "–ì—ñ–ø–µ—Ä—Ä–µ–∞–ª—ñ–∑–º, —ñ–¥–µ–∞–ª—å–Ω–∞ —Ñ—ñ–∑–∏–∫–∞ –∞–≤—Ç–æ, —Å–≤—ñ—Ç–ª–∞ —Ç–∞ –º—ñ—Å—Ç–∞. –ù–∞–π–∫—Ä–∞—â–∏–π –≤–∏–±—ñ—Ä –¥–ª—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö —Ñ–æ—Ç–æ.", price: "~$0.40 / 5 —Å–µ–∫" },
        "luma": { desc: "–ë–æ–≥ –æ–ø–µ—Ä–∞—Ç–æ—Ä—Å—å–∫–æ—ó —Ä–æ–±–æ—Ç–∏. –Ü–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –¥–∏–Ω–∞–º—ñ—á–Ω–∏—Ö –ø—Ä–æ–ª—å–æ—Ç—ñ–≤ (drone, zoom) —Ç–∞ –∑–º—ñ–Ω–∏ —Ä–∞–∫—É—Ä—Å—É.", price: "~$0.35 / 5 —Å–µ–∫" },
        "minimax-img": { desc: "–ï–∫—Å–ø–µ—Ä—Ç –∑ –ª—é–¥–µ–π. –û–∂–∏–≤–ª—è—î –ø—ñ—à–æ—Ö–æ–¥—ñ–≤ —Ç–∞ –æ–±–ª–∏—á—á—è –±–µ–∑ –º–æ—Ç–æ—Ä–æ—à–Ω–∏—Ö –º—É—Ç–∞—Ü—ñ–π.", price: "~$0.40 / 5 —Å–µ–∫" },
        "minimax-text": { desc: "–¢–æ—á–Ω–µ –¥–æ—Ç—Ä–∏–º–∞–Ω–Ω—è —Ä–µ–∂–∏—Å–µ—Ä—Å—å–∫–∏—Ö –∫–æ–º–∞–Ω–¥ —Ç–∞ —Å–∫–ª–∞–¥–Ω–∏—Ö —Ç–µ–∫—Å—Ç–æ–≤–∏—Ö –ø—Ä–æ–º–ø—Ç—ñ–≤.", price: "~$0.48 / 5 —Å–µ–∫" },
        "wan": { desc: "–ë—é–¥–∂–µ—Ç–Ω–∏–π –º–æ–Ω—Å—Ç—Ä. –í—ñ–¥–∫—Ä–∏—Ç–∞ –º–æ–¥–µ–ª—å –∑ –≤—ñ–¥–º—ñ–Ω–Ω–∏–º —Å–ø—ñ–≤–≤—ñ–¥–Ω–æ—à–µ–Ω–Ω—è–º —Ü—ñ–Ω–∞/—è–∫—ñ—Å—Ç—å.", price: "~$0.25 / 5 —Å–µ–∫" },
        "hunyuan": { desc: "–í–∏—Å–æ–∫–∞ –∫—ñ–Ω–µ–º–∞—Ç–æ–≥—Ä–∞—Ñ—ñ—á–Ω—ñ—Å—Ç—å —Ç–µ–∫—Å—Ç—É. –î–æ–±—Ä–µ –ø—Ä–∞—Ü—é—î –∑ –ø–µ–π–∑–∞–∂–∞–º–∏.", price: "~$0.30 / 5 —Å–µ–∫" }
    };

    // –û–ù–û–í–õ–ï–ù–ù–Ø –û–ü–ò–°–£ –ü–†–ò –í–ò–ë–û–†–Ü
    const modelSelect = document.getElementById('modelSelect');
    const modelDesc = document.getElementById('modelDesc');
    const modelPrice = document.querySelector('.model-price');
    const imageSection = document.getElementById('imageSection');

    modelSelect.addEventListener('change', (e) => {
        const selected = e.target.value;
        modelDesc.innerText = modelDetails[selected].desc;
        modelPrice.innerText = `–û—Ä—ñ—î–Ω—Ç–æ–≤–Ω–∞ —Ü—ñ–Ω–∞: ${modelDetails[selected].price}`;
        
        // –•–æ–≤–∞—î–º–æ –±–ª–æ–∫ –∑ —Ñ–æ—Ç–æ, —è–∫—â–æ —Ü–µ Text-to-Video –º–æ–¥–µ–ª—å
        if (selected === 'wan' || selected === 'hunyuan' || selected === 'minimax-text') {
            imageSection.style.display = 'none';
        } else {
            imageSection.style.display = 'block';
        }
    });

    // DRAG & DROP
    const dropZone = document.getElementById('dropZone');
    const fileInput = document.getElementById('fileInput');
    const imagePreview = document.getElementById('imagePreview');
    const dropText = document.getElementById('dropText');
    const imgUrlInput = document.getElementById('imgUrl');
    let base64Image = null;

    dropZone.addEventListener('click', () => fileInput.click());
    dropZone.addEventListener('dragover', (e) => { e.preventDefault(); dropZone.style.background = '#e6f0ff'; });
    dropZone.addEventListener('dragleave', () => dropZone.style.background = '#f8faff');
    dropZone.addEventListener('drop', (e) => {
        e.preventDefault(); dropZone.style.background = '#f8faff';
        if (e.dataTransfer.files.length) handleFile(e.dataTransfer.files[0]);
    });
    fileInput.addEventListener('change', (e) => { if (e.target.files.length) handleFile(e.target.files[0]); });
    imgUrlInput.addEventListener('input', () => {
        if (imgUrlInput.value.trim() !== "") { base64Image = null; imagePreview.style.display = 'none'; dropText.style.display = 'block'; fileInput.value = ""; }
    });

    function handleFile(file) {
        if (!file.type.startsWith('image/')) return alert('–¢—ñ–ª—å–∫–∏ –∑–æ–±—Ä–∞–∂–µ–Ω–Ω—è!');
        const reader = new FileReader();
        reader.onload = (e) => {
            base64Image = e.target.result;
            imagePreview.src = base64Image; imagePreview.style.display = 'block'; dropText.style.display = 'none'; imgUrlInput.value = "";
        };
        reader.readAsDataURL(file);
    }

    // –õ–û–ì–Ü–ö–ê –ì–ï–ù–ï–†–ê–¶–Ü–á
    document.getElementById('btn').onclick = async () => {
        const status = document.getElementById('status');
        const resultDiv = document.getElementById('result');
        const progressBar = document.getElementById('progressBar');
        const progressContainer = document.getElementById('progressContainer');
        const btn = document.getElementById('btn');

        const selectedModel = modelSelect.value;
        const isImageModel = !['wan', 'hunyuan', 'minimax-text'].includes(selectedModel);
        const finalImageSource = base64Image || imgUrlInput.value;

        if (isImageModel && !finalImageSource) {
            return status.innerText = "‚ùå –î–ª—è —Ü—ñ—î—ó –º–æ–¥–µ–ª—ñ –æ–±–æ–≤'—è–∑–∫–æ–≤–æ –ø–æ—Ç—Ä—ñ–±–Ω–µ —Ñ–æ—Ç–æ!";
        }

        const prompt = document.getElementById('prompt').value;

        status.innerText = "üöÄ –í—ñ–¥–ø—Ä–∞–≤–∫–∞ –∑–∞–ø–∏—Ç—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä...";
        resultDiv.innerHTML = ""; btn.disabled = true;
        progressContainer.style.display = 'block'; progressBar.style.width = '15%';

        let attempts = 0; const MAX_ATTEMPTS = 60;
        
        try {
            const payload = {
                model_id: selectedModel,
                prompt: prompt
            };
            if (isImageModel) payload.image_url = finalImageSource;

            // 1. –ó–ê–ü–£–°–ö
            const response = await fetch('/start', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(payload)
            });

            if (!response.ok) throw new Error("–ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É");

            const data = await response.json();
            const { request_id, endpoint } = data; // –û—Ç—Ä–∏–º—É—î–º–æ —ñ ID, —ñ –ï–Ω–¥–ø–æ—ñ–Ω—Ç
            
            status.innerText = "‚è≥ –ú–æ–¥–µ–ª—å –≥–µ–Ω–µ—Ä—É—î –≤—ñ–¥–µ–æ...";

            // 2. –û–ü–ò–¢–£–í–ê–ù–ù–Ø
            const pollInterval = setInterval(async () => {
                attempts++;
                progressBar.style.width = `${Math.min((attempts / MAX_ATTEMPTS) * 100 * 2, 90)}%`;

                if (attempts > MAX_ATTEMPTS) {
                    clearInterval(pollInterval); status.innerText = "‚è∞ –ß–∞—Å –≤–∏—á–µ—Ä–ø–∞–Ω–æ."; btn.disabled = false; progressContainer.style.display = 'none'; return;
                }
                
                try {
                    // –ó–í–ï–†–ù–ò –£–í–ê–ì–£: –¢–µ–ø–µ—Ä –º–∏ –≤—ñ–¥–ø—Ä–∞–≤–ª—è—î–º–æ POST –∑–∞–ø–∏—Ç –Ω–∞ /status –∑ ID —Ç–∞ endpoint
                    const checkRes = await fetch(`/status`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({ request_id, endpoint })
                    });
                    
                    if (checkRes.status === 200) {
                        const result = await checkRes.json();
                        const finalVideoUrl = result.data?.video?.url || result.video?.url || result.video_url || result.url;

                        if (finalVideoUrl) {
                            clearInterval(pollInterval);
                            progressBar.style.width = '100%'; status.innerText = "‚ú® –ì–æ—Ç–æ–≤–æ!";
                            setTimeout(() => { progressContainer.style.display = 'none'; }, 1000);

                            resultDiv.innerHTML = `
                                <video controls autoplay loop>
                                    <source src="${finalVideoUrl}" type="video/mp4">
                                </video>
                                <div class="action-buttons">
                                    <a href="${finalVideoUrl}" target="_blank" class="action-btn">‚¨áÔ∏è –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ –≤—ñ–¥–µ–æ</a>
                                </div>
                            `;
                            btn.disabled = false;
                        }
                    } else if (checkRes.status === 202) {
                        status.innerText = `‚è≥ –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞–¥—Ä—ñ–≤...`;
                    }
                } catch (pollError) { console.error("–ü–æ–º–∏–ª–∫–∞:", pollError); }
            }, 5000);

        } catch (e) {
            status.innerText = "‚ùå –ü–æ–º–∏–ª–∫–∞: " + e.message; btn.disabled = false; progressContainer.style.display = 'none';
        }
    };
</script>

</body>
</html>